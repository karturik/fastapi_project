# Toloka Tasks API

Toloka Tasks API - API созданный для автоматизации краудсорсинга с Yandex Toloka.
TTAPI разделен на две части - Web API и Процесс автоматизации данных.

## Web API

Web API являются частью ответственной за получение готовых результатов и добавление тасков в толоку.
Описание открытых эндпойнтов можно найти на https://data-relevance.ru/docs. Web API использует библиотеку 
Fastapi и написана на Python 3.

##### Описание файлов:

1) main.py - точка входа в программу, определяет все REST API эндпойнты.
2) database.py - файл конфигурации подключения к базе данных. Основная конфигурация к базе данных лежит в config.json
3) models.py - файл содержащий SQLAlchemy дефиниции для таблиц внутри базы данных.
4) schema.py - файл содержащий "схемы" для общения через REST API. Где используются какие схемы можно найти на https://data-relevance.ru/docs
5) crud.py - файл содержащий "шорткаты" для модификации или пополнения базы данных.
6) authorization.py - файл отвечающий за определения аутентификации пользователя в REST API.

##### Как запустить:

Web API использует Uvicorn для запуска Fastapi. Для него используется отдельная команда:

`sudo uvicorn main:app --host 0.0.0.0 --port 443 --ssl-keyfile=/путь к приватному ключу/ --ssl-certfile=/путь к полному ключу/ --log-config ./log.ini`

Эта команда запускает сервер на порту 443(стандартный порт для https) и также этот сервер будет использовать ключи шифрования указанные в аргументах `ssl-keyfile` и `ssl-certfile`.

## Автоматизация

Автоматизация является частью ответственной за работу с Толокой(обновление данных, принятие и отклонение ответов на толоке).
За автоматизацию отвечает единственный файл - `authomation.py`, в котором есть две функции `check_active_pools`, `add_task_to_toloka`.
При запуске скрипта, две функции будут циклично вызываться друг за другом. Скрипт также проверяет что между каждыми итерациями проходить как минимум 2 минуты.
Также для конфигурации скрипта используется файл `automation_config.json`

#### Как запустить:

Запускается скрипт простой командой:

`python automation.py`
